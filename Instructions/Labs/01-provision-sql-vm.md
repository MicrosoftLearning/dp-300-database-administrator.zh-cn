---
lab:
  title: 实验室 1 - 在 Azure 虚拟机上预配 SQL Server
  module: Plan and Implement Data Platform Resources
---

# 在 Azure 虚拟机上预配 SQL Server

预计时间：30 分钟

学生将探索 Azure 门户，并使用它来创建一个安装了SQL Server 2022 的 Azure VM。 然后，他们将通过远程桌面协议连接到虚拟机。

你是 AdventureWorks 的数据库管理员。 你需要创建一个测试环境用于概念证明。 概念证明将在 Azure 虚拟机上使用 SQL Server 和AdventureWorksDW 数据库的备份。 你需要设置虚拟机、还原数据库并对其进行查询以确保其可用。

## 在 Azure 虚拟机上部署 SQL Server

1. 在实验室虚拟机中，启动浏览器会话并导航到 [https://portal.azure.com](https://portal.azure.com/)，然后使用与 Azure 订阅关联的 Microsoft 帐户登录。

1. 在页面顶部找到搜索栏。 搜索 Azure SQL。 选择“服务”下的结果中显示的 Azure SQL 的搜索结果 。

1. 在 Azure SQL 边栏选项卡中，选择“创建” 。

1. 在“选择 SQL 部署选项”边栏选项卡上，单击“SQL 虚拟机”下的下拉框 。 选择标记为“**免费 SQL Server 许可证：Windows Server 2022 上的 SQL Server 2022 Developer**”的选项。 然后选择“创建”。

1. 在“**创建虚拟机**”页上，输入以下信息，*将所有其他选项保留为默认值*：

    - **订阅：**&lt;你的订阅&gt;
    - 资源组：&lt;你的资源组&gt;
    - **虚拟机名称：** AzureSQLServerVM
    - **区域：**&lt;选择本地区域，与资源组的选定区域相同。&gt;
    - 可用性选项：无需基础结构冗余
    - **图像：** 免费 SQL Server 许可证：Windows Server 2022 上的 SQL 2022 Developer - Gen2
    - **使用 Azure 现成 VM 折扣运行：** 否（未选中）
    - **大小：** 标准 *D2s_v5*（2 个 vCPU，8 GiB 内存）。 *可能需要选择“查看所有大小”链接来查看此选项。*
    - **管理员帐户用户名：**&lt;选择管理员帐户的名称。&gt;
    - **管理员帐户密码：**&lt;选择强密码。&gt;
    - 选择入站端口：RDP (3389)
    - 是否要使用现有的 Windows Server 许可证?：否（未选中）

    > &#128221; 记下用户名和密码以供日后使用。

1. 导航到“磁盘”选项卡，然后查看配置。

1. 导航到“网络”选项卡，然后查看配置。

1. 导航到“管理”选项卡，然后查看配置。

    验证“启用 auto_shutdown”是否未选中。

1. 导航到“高级”选项卡，然后查看配置。

1. 导航到“SQL Server 设置”选项卡，然后查看配置。

    > &#128221; 请注意，还可在此屏幕上为 SQL Server VM 配置存储。 默认情况下，SQL Server Azure VM 模板创建一个具有读取数据缓存的高级磁盘、一个不具有事务日志缓存的高级磁盘，并为 tempdb 使用本地 SSD（在 Windows上为 D:\）。

1. 选择“查看 + 创建”按钮。 然后选择“创建”。

1. 在“部署”边栏选项卡上，等待部署完成。 部署 VM 大约需要 5-10 分钟。 部署完成后，选择“转到资源”。

    > &#128221; 请注意，部署可能需要几分钟时间才能完成。

1. 在虚拟机的概述页面上，浏览此资源的菜单选项，查看可用内容。

---

## 在 Azure 虚拟机上连接到 SQL Server

1. 在虚拟机的“**概述**”页上，选择“**连接**”下拉菜单，然后选择“**连接**”。

1. 在“连接”窗格上，选择**下载 RDP 文件**按钮。

    > &#128221; 如果看到“**不满足端口先决条件**”错误。 请确保选择链接以添加入站网络安全组规则，并在“端口号”字段中提及目标端口。

1. 打开刚刚下载的 RDP 文件。 当出现询问是否要连接的对话框时，选择“连接”。

1. 输入在虚拟机预配过程中选择的用户名和密码。 然后选择“确定”****。

1. 当出现询问你是否要进行连接的“远程桌面连接”对话框时，选择“是” 。

1. 选择 Windows“开始”按钮旁边的搜索栏，然后键入 SSMS。 从列表中选择“Microsoft SQL Server Management Studio”。****  

1. 当 SSMS 打开时，请注意，**连接到服务器**对话框将使用默认实例名称预填充。 选中**信任服务器证书**选项，然后选择**连接**。

1. 选择右上角的 **X** 关闭 SSMS。

1. 现在可以从虚拟机断开连接以关闭 RDP 会话。

Azure 门户提供了强大的工具用于管理虚拟机中托管的 SQL Server。 这些工具包括对自动修补的控制、自动备份和简捷的高可用性设置方式。

---

## 清理资源

如果不将虚拟机用于任何其他目的，则可以清理在此实验室中创建的资源。

### 删除资源组

如果为此实验室创建了一个新的资源组，则可以删除资源组以移除在此实验室中创建的所有资源。

1. 在 Azure 门户中，从左侧导航窗格中选择“**资源组**”，或在搜索栏中搜索“**资源组**”，并从结果中选择资源组。

1. 转到为此实验室所创建的资源组。 资源组将包含在此实验室中创建的虚拟机和其他资源。

1. 在顶部菜单中选择“删除资源组”。

1. 在“**删除资源组**”对话框中，输入资源组的名称进行确认，然后选择“**删除**”。

1. 等待资源组被删除。

1. 关闭 Azure 门户。

### 仅删除实验室资源

如果未为此实验室创建新的资源组，并且想要使资源组及其以前的资源保持不变，仍可以删除在此实验室中创建的资源。

1. 在 Azure 门户中，从左侧导航窗格中选择“**资源组**”，或在搜索栏中搜索“**资源组**”，并从结果中选择资源组。

1. 转到为此实验室所创建的资源组。 资源组将包含在此实验室中创建的虚拟机和其他资源。

1. 选择前面在实验室中指定的虚拟机名称为前缀的所有资源。

1. 从顶部菜单中选择**删除**。

1. 在“**删除资源**”对话框中，键入“**删除**”并选择“**删除**”。

1. 再次选择“**删除**”，确认删除资源。

1. 等待资源删除完毕。

1. 关闭 Azure 门户。

---

你已成功完成本实验室。
